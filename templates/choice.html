{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto pt-8">
    <div class="flex items-center justify-between mb-6">
        <span class="text-sm font-bold text-slate-400 uppercase tracking-widest">Scenario Maze</span>

        <div class="flex items-center gap-6">
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                Pessimism Level: {{ session.get('user_input', {}).get('pessimism', 'Realistic') }}
            </span>
            <span class="px-3 py-1 bg-slate-900 text-white text-xs font-bold rounded-full">
                Obstacle {{ index }} / {{ total }}
            </span>
        </div>
    </div>

    <div class="bg-white rounded-3xl shadow-xl shadow-red-100/50 border border-red-100 overflow-hidden mb-10">
        <div class="bg-red-50/50 px-8 py-6 border-b border-red-100 flex items-center gap-4">
            <div class="p-3 bg-red-100 text-red-600 rounded-xl"><i data-lucide="siren" class="w-8 h-8"></i></div>
            <div>
                <h2 class="text-lg font-bold text-red-900">{{ scenario.title }}</h2>
                <p class="text-[10px] text-red-700 font-bold uppercase tracking-tight">Timeline Failure Warning</p>
            </div>
        </div>
        <div class="p-8 md:p-10">
            <h3 class="text-2xl font-bold text-slate-900 leading-tight">{{ scenario.desc }}</h3>
        </div>
    </div>

    <form action="/process_maze" method="POST">
        <h4 class="text-xl font-bold text-slate-900 mb-6 px-2">What would you have done to prepare?</h4>

        <div class="space-y-4">
            {% for option in scenario.options %}
            <label class="block cursor-pointer">
                <input type="radio" name="choice" value="{{ option }}" class="peer sr-only" {% if loop.first %}checked{% endif %} onclick="document.getElementById('other-box').classList.add('hidden')">
                <div class="p-5 bg-white border border-slate-200 rounded-2xl hover:border-indigo-400 peer-checked:border-indigo-600 peer-checked:bg-indigo-50/10 transition-all">
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-bold text-slate-800">{{ option.split('[')[0].strip() }}</span>
                        <div class="w-5 h-5 rounded-full border-2 border-slate-200 peer-checked:border-indigo-600 flex items-center justify-center">
                            <div class="w-2.5 h-2.5 bg-indigo-600 rounded-full opacity-0 peer-checked:opacity-100"></div>
                        </div>
                    </div>
                    {% if '[' in option %}
                    <div class="flex gap-4">
                        {% set scores = option.split('[')[1].replace(']', '').split(',') %}
                        {% for s in scores %}
                            {% set score_parts = s.strip().split(':') %}
                            {% set label = score_parts[0].strip() %}
                            {% set value = score_parts[1].strip() | int %}

                            {# Severity Logic: Green (Better), Amber (Moderate), Red (Worse) #}
                            {% if label == 'Feasibility' %}
                                {# Higher is Better #}
                                {% set color_class = 'bg-emerald-100 text-emerald-700' if value >= 8 else 'bg-amber-100 text-amber-700' if value >= 4 else 'bg-rose-100 text-rose-700' %}
                            {% else %}
                                {# Stress/Deviation: Lower is Better #}
                                {% set color_class = 'bg-emerald-100 text-emerald-700' if value <= 3 else 'bg-amber-100 text-amber-700' if value <= 7 else 'bg-rose-100 text-rose-700' %}
                            {% endif %}

                            <span class="text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded {{ color_class }}">
                                {{ s.strip() }}
                            </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </label>
            {% endfor %}

            <label class="block cursor-pointer">
                <input type="radio" name="choice" value="Other" class="peer sr-only" onclick="document.getElementById('other-box').classList.remove('hidden')">
                <div class="p-5 bg-white border border-slate-200 rounded-2xl hover:border-indigo-400 peer-checked:border-indigo-600 peer-checked:bg-indigo-50/10 transition-all">
                    <span class="font-bold text-slate-800">Other (Your own solution)</span>
                </div>
            </label>
        </div>

        <div id="other-box" class="mt-4 hidden fade-in">
            <textarea name="other_text" class="w-full h-32 p-4 border-2 border-indigo-100 rounded-2xl text-sm focus:ring-0 focus:border-indigo-600" placeholder="Type your strategic patch..."></textarea>
        </div>

        <div class="mt-10 flex justify-end">
            <button type="submit" class="px-10 py-5 bg-slate-900 text-white font-bold rounded-xl shadow-lg hover:bg-slate-800 flex items-center gap-3 transition-all active:scale-95">
                {{ 'Seal Timeline' if index == total else 'Next Obstacle' }} <i data-lucide="arrow-right" class="w-5 h-5"></i>
            </button>
        </div>
    </form>
</div>
{% endblock %}