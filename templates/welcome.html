{% extends "base.html" %}

{% block content %}
<div class="relative min-h-[80vh] flex flex-col items-center justify-center">
    <div class="max-w-3xl mx-auto text-center z-10">
        <div class="mb-12">
            <h1 class="text-5xl font-extrabold text-slate-900 tracking-tight mb-4">Welcome to Murphy</h1>
            <p class="text-xl text-slate-500 leading-relaxed">
                A specialized stress-testing system reporting failures from your future timeline.
            </p>
        </div>

        <div class="bg-white p-10 rounded-[2.5rem] shadow-xl shadow-slate-200/50 border border-slate-100 max-w-md mx-auto">
            <h3 class="text-lg font-bold text-slate-900 mb-6 uppercase tracking-widest">Pick a user to begin</h3>

            <div class="space-y-6">
                <div class="relative">
                    <select onchange="handleWelcomeUserChange(this)"
                            class="w-full appearance-none bg-slate-50 border-2 border-slate-100 rounded-xl px-4 py-4 text-base font-bold text-slate-700 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer transition-all">
                        <option value="-1" {% if session.get('db_user_id', -1) == -1 %}selected{% endif %}>Select Profile...</option>
                        <option value="NEW" class="font-bold text-amber-700">+ Register New User</option>
                        <hr>
                        {% for u in all_users %}
                        <option value="{{ u.id }}" {% if session.get('db_user_id') == u.id %}selected{% endif %}>
                            {{ u.username }}
                        </option>
                        {% endfor %}
                    </select>

                    <div class="absolute right-8 top-1/2 -translate-y-1/2 pointer-events-none text-slate-400">
                        <i data-lucide="chevron-down" class="w-6 h-6"></i>
                    </div>
                </div>

                <a href="{{ url_for('index') }}"
                   id="getStartedBtn"
                   class="block w-full px-8 py-5 bg-amber-700 text-white text-[16px] font-bold rounded-xl shadow-xl hover:bg-amber-600 transition-all active:scale-95
                          {% if session.get('db_user_id', -1) == -1 %}pointer-events-none opacity-50 cursor-not-allowed{% endif %}">
                    Get Started
                </a>
            </div>
        </div>
    </div>

    <div class="fixed bottom-8 right-8 max-w-[280px] pointer-events-none hidden lg:block">
        <img src="{{ url_for('static', filename='images/nick_with_clock.png') }}"
             alt="Nick with Clock"
             class="w-full h-auto object-contain drop-shadow-2xl">
    </div>
</div>

<script>
    function handleWelcomeUserChange(select) {
        const val = select.value;
        const btn = document.getElementById('getStartedBtn');

        // 1. Instant UI Logic: Toggle button state locally
        if (val === "-1") {
            btn.classList.add('pointer-events-none', 'opacity-50', 'cursor-not-allowed');
        } else {
            btn.classList.remove('pointer-events-none', 'opacity-50', 'cursor-not-allowed');
        }

        // 2. Redirect/Action Logic
        if (val === "NEW") {
            toggleUserModal(true);
            // Revert select display to current session user if modal is closed
            select.value = "{{ session.get('db_user_id', -1) }}";
            // Re-check button state after revert
            if (select.value === "-1") btn.classList.add('pointer-events-none', 'opacity-50', 'cursor-not-allowed');
        } else if (val !== "-1") {
            // Only update the server session if an actual user is selected
            window.location.href = "/switch_user/" + val;
        }
    }
</script>
{% endblock %}